<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Dental Lab App - New Patient</title>

        <!-- Main Stylesheet
        <link href="css/style.css" rel="stylesheet"> -->

                
        <style>
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                color: #333;
                max-width: 1200px;
                margin: 0 auto;
            }
            
            header {
                background-color: #f0f8ff;
                padding: 20px;
                margin-bottom: 20px;
                border-radius: 5px;
            }
            
            h1 {
                margin: 0;
                color: #2c5282;
            }
            
            h2 {
                color: #4a5568;
                margin-top: 10px;
            }
            
            article {
                background-color: #f7fafc;
                padding: 20px;
                border-radius: 5px;
                margin-bottom: 20px;
            }
            
            fieldset {
                border: 1px solid #ddd;
                border-radius: 5px;
                padding: 20px;
                margin-bottom: 20px;
            }
            
            legend {
                font-weight: bold;
                color: #2c5282;
                padding: 0 10px;
            }
            
            div {
                margin-bottom: 15px;
            }
            
            label {
                display: inline-block;
                width: 200px;
                margin-right: 10px;
            }
            
            input, select {
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                width: 200px;
            }
            
            input[type="date"] {
                width: 210px;
            }
            
            input:focus, select:focus {
                outline: none;
                border-color: #4299e1;
                box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.2);
            }
            
            button {
                background-color: #4299e1;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
            }
            
            button:hover {
                background-color: #2b6cb0;
            }
            
            footer {
                text-align: center;
                margin-top: 30px;
                padding: 10px;
                color: #718096;
                font-size: 0.9em;
            }
            
            #services-options, #toothMaterial {
                margin-top: 20px;
                padding-left: 20px;
                border-left: 3px solid #ebf8ff;
            }
        </style>
    
    </head>
    <body>
        <section>
            <!-- Header Section -->
            <header>
                <h1>Dental Lab App</h1>
                    <h2>New Patient</h2>
            </header>
            <!-- New Patient Form -->
            <article>
                <form action="#" id="newCaseForm">
                    <fieldset>
                        <legend>Patient Information</legend>

                        <!-- Case ID -->
                        <div>
                            <label for="id">Case ID : </label>
                            <input type="number" id="caseId" required>
                        </div>
                        <!-- Person's Title -->
                        <div>
                            <label for="title">Title : </label>
                            <select name="" id="patientTitle">
                                <option value="" disabled selected hidden >Please Choose...</option>
                                <option value="Mr">Mr</option>
                                <option value="Mrs">Mrs</option>
                                <option value="Miss">Miss</option>
                            </select>
                        </div>
                        <!-- Person's Name -->
                        <div>
                            <label for="first-name" >First name : </label>
                            <input type="text" id="firstName" placeholder="John" required>
                        </div>
                        <div>
                            <label for="last-name" >Last name : </label>
                            <input type="text" id="lastName" placeholder="Doe" required>
                        </div>
                        <!-- Dentist's name -->
                         <div>
                            <label for="dentist">Dentist : </label>
                            <input type="text" id="dentistName" required>
                         </div>
                        <!-- Clinic's name -->
                        <div>
                            <label for="clinic">Clinic : </label>
                            <input type="text" id="clinic" required>
                        </div>
                        
                         <!-- Case start date -->
                        <div>
                            <label for="start-date">Case Start Date : </label>
                            <input type="date" id="startDate">
                        </div>
                        <!-- Case Due Date -->
                        <div>
                            <label for="due-date">Case Due Date : </label>
                            <input type="date" id="dueDate" required>
                        </div>
                        <!-- Delivery Method -->
                         <div>
                            <label for="delivery">Delivery Method : </label>
                            <select name="" id="delivery">
                                <option value="" disabled hidden selected>Please Choose...</option>
                                <option value="postal">Postal</option>
                                <option value="collection">Collection</option>
                            </select>
                         </div>
                    </fieldset>

                    <fieldset>
                        <legend>Services</legend>

                            <!-- Main services -->
                            <div>
                                <label for="">Type of Service : </label>
                                <select name="" id="services">
                                    <option value="" disabled hidden selected>Please Choose...</option>
                                    <option value="removables">Removables</option>
                                    <option value="restorations">Restorations</option>
                                </select>
                            </div>

                            <!-- Removables or Restoration services -->
                            <div id="services-options">

                            </div>
                            
                            <!-- Tooth and Material Selection -->
                             <div id="toothMaterial">

                             </div>

                            

                    </fieldset>
                    <div>
                        <button id="submit" type="submit" >Submit</button>
                    </div>
                </form>

                
            </article>

        </section> 

        <!-- footer  -->
        <footer>
            <p>&copy; 2025 Dental Lab App. All rights reserved by Aenan Bashir.</p>
        </footer>

        <!-- JavaScript Section -->
        <script>
            // selecting services
            let servicesSelection = document.getElementById("services");

            // First Drop down 
            let removablesSelection = '<label for="">Type of Removables : </label> \
                                <select name="" id="removables"> \
                                    <option value="" disabled hidden selected>Please Choose...</option> \
                                    <option value="nightGuard">NightGuard</option> \
                                    <option value="whiteningTray">Whitening Tray</option> \
                                    <option value="digitalModel">Digital Models</option> \
                                    <option value="splint">Splint</option> \
                                </select>';
            
            let restorationsSelection = '<label for="">Type of Restorations : </label> \
                                <select name="" id="restorations"> \
                                    <option value="" disabled hidden selected>Please Choose...</option> \
                                    <option value="crown">Crown</option> \
                                    <option value="implant">Implant</option> \
                                </select>';

            let restorationsTeethSelection = '<label for="tooth" >Tooth : </label> \
                            <input type="text" placeholder="LL / LR / UL / UR"> \
                            <label for="">Material</label> \
                            <select name="" id=""> \
                                <option value="zr">Zirconia</option> \
                                <option value="emax">Emax</option> \
                                <option value="metal">Metal</option> \
                                <option value="pbc">Porcelin Bonded</option> \
                            </select>';

            // Selection of First Drop down as per selction
            servicesSelection.addEventListener("change", function(){ 
                
                if (servicesSelection.value == "removables") {
                    document.getElementById("services-options").innerHTML = removablesSelection;

                    document.getElementById("toothMaterial").innerHTML = "";
                }else{
                    document.getElementById("services-options").innerHTML = restorationsSelection;
                    
                    // selecting restorations option
                    let restorationSelectionFinal = document.getElementById("restorations");

                    restorationSelectionFinal.addEventListener("change", function(){ 
                        
                        document.getElementById("toothMaterial").innerHTML = restorationsTeethSelection;
                    });
                };
            });

            // Submit button actions
            // forms to values
            // make array of values
            // values to local memory (serialization  of data)
            // take the page to index
            // update the table on index with new table always when open index (deserialization of data)

            // Submit Button
            document.getElementById("newCaseForm").addEventListener("submit", function(){
                
                event.preventDefault();
                
                // forms to values
                let caseId = document.getElementById("caseId").value;
                let patientTitle = document.getElementById("patientTitle").value;
                let firstName = document.getElementById("firstName").value;
                let lastName = document.getElementById("lastName").value;
                let dentistName = document.getElementById("dentistName").value;
                let clinic = document.getElementById("clinic").value;
                let startDate = document.getElementById("startDate").value;
                let dueDate = document.getElementById("dueDate").value;
                let delivery = document.getElementById("delivery").value;
                let status = "inProgress";
                
                //values to Object
                const patientValues = {case_id:caseId , patient_title:patientTitle , first_name:firstName , last_name:lastName , dentist_name:dentistName , clinic_name:clinic , start_date:startDate , due_date:dueDate , delivery_method:delivery , case_status:status};

                // Array of all data
                //serialization of data (Object to JSON.stringify) and storing data in local storage

                if (localStorage.getItem("patientData") == null){
                        const allData = [patientValues];
                        localStorage.setItem("patientData",JSON.stringify(allData));
                    }else{
                        const allData = JSON.parse(localStorage.getItem("patientData"));

                        // checking if we have the same Id in database
                        for(let i = 0 ; i < allData.length ; i++){
                            if (caseId == allData[i].case_id){
                              
                                // Alert that we have same ID
                                let result = confirm("his Case ID already exists \n Do you want to OVERWRITE or CHANGE ID \n To OVERWRITE click OK and Cancel to CHANGE ID");
                                if (result) {

                                    // OVERWRITE CODE
                                    allData[i] = patientValues;                                    
                                    localStorage.setItem("patientData",JSON.stringify(allData));
                                    window.location.href="index.html";
                                    return;
                                } else {
                                    return;
                                }                                
                            }
                        }

                        allData.push(patientValues);
                        localStorage.setItem("patientData",JSON.stringify(allData));
                    }

                window.location.href="index.html";
            });
           
        </script>  
    </body>
</html>